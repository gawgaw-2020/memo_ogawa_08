<?php include(dirname(__FILE__).'/_inc/_header.html'); ?>

  <main>
    <h1 class="heading heading--level1">朝やることリスト</h1>
    <p class="text">やること候補から選択してやることリストを作るアプリです</p>
    <p class="text">セーブすると作成される、作成されたリストはタッチすると消える</p>
    <section>
      <h2 class="heading heading--level2">その日やることの候補一覧</h2>
      <p class="text">やることにチェックボックスを入れてね</p>
      <div id="todoOptions">
        <!-- ここに配列のtodoOptionsが入ってくる -->
      </div>
    </section>
    <section>
      <h2 class="heading heading--level2">セーブ・クリアー</h2>
      <p class="text">ローカルストレージへの保存・全クリアー</p>
      <button id="create" class="btn btn--primary" href="hoge.html">OKボタン</button>
      <button id="clear" class="btn btn--cancel" href="hoge.html">データクリア</button>  
      <button class="btn btn--disable" href="hoge.html">押せないボタン</button>  
    </section>
    <section>
      <h2 class="heading heading--level2">セーブしたやることリストの一覧表示デモ</h2>
      <p class="text">上で選択したアイテムが並ぶ</p>
      <ul id="todolist">

      </ul>
    </section>
    <section>
      <h2 class="heading heading--level2">確認したら次のページへ</h2>
      <p class="text">次ページへのリンク</p>
      <a id="create" class="btn btn--primary" href="hoge.html">OKボタン</a>
    </section>
  </main>

  <?php include(dirname(__FILE__).'/_inc/_footer.html'); ?>

  <!-- ページ固有のスクリプト -->
  <script>

    // todoの選択肢を配列で定義
    const todoOptions = [
      'お水を飲む',
      'クイックルワイパー',
      'お弁当を作る',
      '洗濯する',
      'トイレ掃除',
      'お風呂掃除',
      '晩ご飯作る',
      'シンク掃除',
    ];


    // 配列の数だけ、idを付けながらhtmlを生成
    for (let i = 0; i < todoOptions.length; i++) {
      h = `<label><input id="test${i}" type="checkbox" name="todo" value="${todoOptions[i]}">${todoOptions[i]}</label>`;
      $("#todoOptions").append(h);
    }


    // inputの数だけ、クリックイベントを生成 チェックされたらストレージに保存 チェック外れる時はストレージから削除
    for (let i = 0; i < todoOptions.length; i++) {
      $(`#test${i}`).on('click', () => {
        if ( $(`#test${i}`).is(':checked') ) {
          const key = i;
          const todo = $(`#test${i}`).val();
          localStorage.setItem(key, todo);
        } else {
          localStorage.removeItem(i);
        }
      });
    }

    console.log(localStorage);


    // 並び替えて各オブジェクトを配列として格納
    // 1.キーの一覧を配列として取得
    // 2.sort()で並び替え
    // 3.map()で新しい配列を作成 引数はkey、ストレージのvalueを加えたオブジェクトを返している
    const collection = Object.keys(localStorage).sort().map((key) => {
      return {
          key: key,
          value: localStorage.getItem(key)
      }
    });

    // 取れてるかログにテスト
    console.log(collection);
    for (let i = 0; i < collection.length; i++) {
      console.log(collection[i].value);
      console.log(collection[i].key);
    }

    // idを付けながら下部にhtml生成
    for (let i = 0; i < localStorage.length; i++) {
      const key = collection[i].key;
      const todo = collection[i].value;
      const h = '<tr id=list'+i+'><td>' + key + '</td><td>' + todo + '</td></tr>';
      $("#todolist").append(h);
    }

    // 読み込む事で描写
    $('#create').on('click', () => {
      window.location.href = '/memo_ogawa_08/';

    });

    // ローカルストレージのデータクリア
    $('#clear').on('click', () => {
      localStorage.clear()
      window.location.href = '/memo_ogawa_08/';
    });


    // ストレージの配列からキーに当てはまるリストに予めチェックをつける
    collection.forEach(function( value ) {
      $(`#test${value.key}`).prop('checked', true);
    });








  </script>

  <?php include(dirname(__FILE__).'/_inc/_common-script.html'); ?>


